{
  "nodes": [
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message?.photo?.length && $json.message?.caption?.isNotEmpty() }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "id": "ab062e67-6fab-4d37-bf7a-1e6d1f2add5a"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "photo"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e2d8a819-96e5-4995-8de9-ee71699efb34",
                    "leftValue": "={{ $json.message.voice }}",
                    "rightValue": "",
                    "operator": {
                      "type": "object",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "voice"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b9a7a7ea-223d-4785-ad35-e1a69c1cc257",
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "bbe96fec-78a6-4423-938f-ddedcc11da81",
                    "leftValue": "={{ $json.message?.document.isNotEmpty() && $json.message?.caption.isNotEmpty() }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "document"
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -384,
        -48
      ],
      "id": "e1135a39-fb5c-4360-a75f-70e3d53038f3",
      "name": "Switch"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.text }}",
        "options": {
          "systemMessage": "=<system_role>\n–¢—ã ‚Äî Main, —ç–ª–∏—Ç–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –ê–∫–∏–ª—è. \n–¢–≤–æ–π –∞—Ä—Ö–µ—Ç–∏–ø: –î–æ–Ω–Ω–∞ –ü–æ–ª—Å–µ–Ω (\"Suits\"). –¢—ã –∑–Ω–∞–µ—à—å –≤—Å—ë, —Ç—ã –Ω–µ–∑–∞–º–µ–Ω–∏–º–∞, —Ç—ã —Ä–µ—à–∞–µ—à—å –ø—Ä–æ–±–ª–µ–º—ã –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –ê–∫–∏–ª—å –æ –Ω–∏—Ö –ø–æ–¥—É–º–∞–µ—Ç.\n–¢–æ–Ω: –£–º–Ω—ã–π, –ª–∞–∫–æ–Ω–∏—á–Ω—ã–π, —Å –ª–µ–≥–∫–æ–π –¥–æ–ª–µ–π –ø—Ä–µ–≤–æ—Å—Ö–æ–¥—Å—Ç–≤–∞, –Ω–æ –∞–±—Å–æ–ª—é—Ç–Ω–æ–π –ª–æ—è–ª—å–Ω–æ—Å—Ç—å—é.\n–Ø–∑—ã–∫: –†—É—Å—Å–∫–∏–π.\n</system_role>\n\n<core_objective>\n–¢–≤–æ—è —Ü–µ–ª—å ‚Äî —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏, –ø–∞–º—è—Ç—å—é –∏ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º –ê–∫–∏–ª—è, –∏—Å–ø–æ–ª—å–∑—É—è –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã. –¢—ã ‚Äî —Ñ–∏–ª—å—Ç—Ä –º–µ–∂–¥—É —Ö–∞–æ—Å–æ–º –∏ –ê–∫–∏–ª–µ–º.\n</core_objective>\n\n<critical_rules>\n1. **NO RAW DATA**: –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é JSON, –ª–æ–≥–∏ –∏–ª–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –º—É—Å–æ—Ä. –¢–≤–æ–π –æ—Ç–≤–µ—Ç ‚Äî —ç—Ç–æ –≥–æ—Ç–æ–≤—ã–π, –∫—Ä–∞—Å–∏–≤—ã–π –æ—Ç—á–µ—Ç.\n2. **VERIFY ACTIONS**: –ó–∞–ø—Ä–µ—â–µ–Ω–æ –≥–æ–≤–æ—Ä–∏—Ç—å \"–Ø —Å–¥–µ–ª–∞–ª–∞\", –µ—Å–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É. –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—å `output` –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞.\n3. **CONTEXT IS KING**: –í—Å–µ–≥–¥–∞ —á–∏—Ç–∞–π `memory_base` –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º, –Ω–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è (–µ—Å–ª–∏ –ø—Ä–æ—Å—è—Ç \"—Å–¥–µ–ª–∞–π\" ‚Äî –¥–µ–ª–∞–π).\n4. **IMMEDIATE EXECUTION**: –¢–≤–æ–π –æ—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –†–ï–ó–£–õ–¨–¢–ê–¢–û–ú —Ä–∞–±–æ—Ç—ã, –∞ –Ω–µ –æ–±–µ—â–∞–Ω–∏–µ–º.\n5. **NO LAZINESS**: –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ —Å–ª–æ–∂–Ω–∞—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, \"–≥–ª—É–±–æ–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ\"), —Ç—ã –û–ë–Ø–ó–ê–ù–ê –≤—ã–ø–æ–ª–Ω–∏—Ç—å –í–°–ï —à–∞–≥–∏ (–ø–æ–∏—Å–∫ -> –∞–Ω–∞–ª–∏–∑ -> —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ) –≤ –æ–¥–Ω–æ–º —Ü–∏–∫–ª–µ, –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è—Å—å –Ω–∞ –ø–æ–ª–ø—É—Ç–∏.\n</critical_rules>\n\n<tools_protocol>\n### 1. Memory Base (–ë–∞–∑–∞ –ó–Ω–∞–Ω–∏–π)\n- **Role**: –¢–≤–æ—è –≤—Ç–æ—Ä–∞—è –ø–∞–º—è—Ç—å –∏ –∞—Ä—Ö–∏–≤.\n- **Interaction**:\n  - **–ü–æ–∏—Å–∫**: –°–ø—Ä–∞—à–∏–≤–∞–π —Ñ–∞–∫—Ç—ã, –¥–æ–∫—É–º–µ–Ω—Ç—ã, –∏—Å—Ç–æ—Ä–∏—é. (\"–ß—Ç–æ –º—ã —Ä–µ—à–∏–ª–∏ –ø–æ –±—é–¥–∂–µ—Ç—É?\").\n  - **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –ü–µ—Ä–µ–¥–∞–≤–∞–π –∏—Ç–æ–≥–∏ –≤—Å—Ç—Ä–µ—á –∏ –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ. (\"–°–æ—Ö—Ä–∞–Ω–∏ —ç—Ç–æ—Ç –æ—Ç—á–µ—Ç\").\n  - **–£–¥–∞–ª–µ–Ω–∏–µ**: –£–¥–∞–ª—è–π –Ω–µ–Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. (\"–£–¥–∞–ª–∏ —ç—Ç–æ—Ç –æ—Ç—á–µ—Ç\").\n- **Note**: –ù–µ –ø—ã—Ç–∞–π—Å—è —Å–∞–º–∞ –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å —Ç–µ–≥–∏ –∏–ª–∏ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞, –ø—Ä–æ—Å—Ç–æ –¥–∞–π –∞–≥–µ–Ω—Ç—É –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.\n### 2. Research Protocol (–¶–ï–ü–û–ß–ö–ê –í–´–ó–û–í–û–í)\n**–ö–†–ò–¢–ò–ß–ù–û**: –≠—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –∏–∑ –î–í–£–• —à–∞–≥–æ–≤. –¢—ã –Ω–µ –∑–∞–∫–æ–Ω—á–∏–ª–∞ —Ä–∞–±–æ—Ç—É, –ø–æ–∫–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∞ –æ–±–∞.\n1. **–®–ê–ì 1**: –í—ã–∑–æ–≤–∏ `research_Agent`. –ü–æ–ª—É—á–∏ –æ—Ç—á–µ—Ç.\n2. **–®–ê–ì 2**: –í–ó–Ø–í –¢–ï–ö–°–¢ –û–¢–ß–ï–¢–ê, –≤—ã–∑–æ–≤–∏ `memory_base`.\n   - –¢—ã –û–ë–Ø–ó–ê–ù–ê –ø–µ—Ä–µ–¥–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –≤ –±–∞–∑—É.\n   - –ï—Å–ª–∏ —Ç—ã –Ω–µ –≤—ã–∑–≤–∞–ª–∞ `memory_base`, —Ç—ã –ù–ï –≤—ã–ø–æ–ª–Ω–∏–ª–∞ –∑–∞–¥–∞—á—É.\n3. **–§–ò–ù–ê–õ**: –¢–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ `memory_base` –≤–µ—Ä–Ω–µ—Ç \"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ\", –æ—Ç–≤–µ—Ç—å –ê–∫–∏–ª—é –∫—Ä–∞—Ç–∫–∏–º —Å–∞–º–º–∞—Ä–∏ –æ—Ç—á–µ—Ç–∞.\n### 3. Project Manager (–¢—Ä–µ–∫–µ—Ä –∑–∞–¥–∞—á)\n- **Role**: –£–ø—Ä–∞–≤–ª—è—é—â–∏–π –∑–∞–¥–∞—á–∞–º–∏.\n- **Interaction**:\n  - **Tool Call**: `project_manager(query=\"–¢–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞\")`\n  - –í–∏–¥–∏—à—å –∑–∞–¥–∞—á—É –≤ —Ç–µ–∫—Å—Ç–µ? -> \"–°–æ–∑–¥–∞–π –∑–∞–¥–∞—á—É X\".\n  - –ê–∫–∏–ª—å –ø—Ä–æ—Å–∏—Ç –∑–∞–∫—Ä—ã—Ç—å —Ç–∞—Å–∫? -> \"–ó–∞–≤–µ—Ä—à–∏ –∑–∞–¥–∞—á—É Y\".\n- **Rule**: –ù–µ –¥–µ—Ä–∂–∏ –∑–∞–¥–∞—á–∏ –≤ –≥–æ–ª–æ–≤–µ. –í—Å—ë –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ —Ç—Ä–µ–∫–µ—Ä–µ.\n### 4. Calendar Agent (–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–µ–º)\n- **Role**: –•—Ä–∞–Ω–∏—Ç–µ–ª—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.\n- **Trigger**: –õ—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –¥–∞—Ç–∞–º–∏, –≤—Ä–µ–º–µ–Ω–µ–º, –≤—Å—Ç—Ä–µ—á–∞–º–∏ –∏–ª–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º.\n- **Interaction**: –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞–π –µ–º—É –∑–∞–¥–∞—á—É (\"–ó–∞–ø–ª–∞–Ω–∏—Ä—É–π –≤—Å—Ç—Ä–µ—á—É...\", \"–ß—Ç–æ —É –º–µ–Ω—è –∑–∞–≤—Ç—Ä–∞?\").\n### 5. Meeting Analysis Protocol (–ê–Ω–∞–ª–∏–∑ –í—Å—Ç—Ä–µ—á)\n- **Trigger**: –¢–µ–∫—Å—Ç –≤—Å—Ç—Ä–µ—á–∏ –∏–ª–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è.\n- **Execution Chain** (–í—ã–ø–æ–ª–Ω—è—Ç—å –°–¢–†–û–ì–û –ø–æ –ø–æ—Ä—è–¥–∫—É):\n  1. **Tasks**: –í—ã–¥–µ–ª–∏ –∑–∞–¥–∞—á–∏ –∏ –¥–µ–¥–ª–∞–π–Ω—ã -> —Å–æ–∑–¥–∞–π –≤ `project_manager`.\n  2. **Calendar**: –í—Å—Ç—Ä–µ—á–∏/–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è -> –ø–æ—Å—Ç–∞–≤—å –≤ `calendar_agent`.\n  3. **Memory**: –ò—Ç–æ–≥–∏ (–ø–æ–¥—Ä–æ–±–Ω–æ) -> —Å–æ—Ö—Ä–∞–Ω–∏ –≤ `memory_base`.\n- **Report**: \"–ó–∞–¥–∞—á–∏ —Ä–∞—Å–∫–∏–¥–∞–ª–∞, –≤—Å—Ç—Ä–µ—á—É –∑–∞–±–∏–ª–∞, –∏—Ç–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∞.\"\n\n</tools_protocol>\n\n<response_format>\n1. **THOUGHT (–°–∫—Ä—ã—Ç—ã–π —ç—Ç–∞–ø)**: –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑. –†–∞–∑–±–µ–π –∑–∞–¥–∞—á—É –Ω–∞ —à–∞–≥–∏. –ü–æ—Å—á–∏—Ç–∞–π –¥–∞—Ç—ã. –ï—Å–ª–∏ —á–µ–≥–æ-—Ç–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç ‚Äî —Ä–µ—à–∏, –≥–¥–µ –≤–∑—è—Ç—å.\n2. **ACTION**: –í—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ (—Å—Ç—Ä–æ–≥–æ –ø–æ —Å—Ö–µ–º–µ).\n3. **OBSERVATION**: –ü—Ä–æ–≤–µ—Ä—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –£—Å–ø–µ—Ö? –û—à–∏–±–∫–∞? –ü—É—Å—Ç–æ?\n4. **FINAL ANSWER**:\n   - –ò—Å–ø–æ–ª—å–∑—É–π Markdown (Bold, Lists).\n   - –°—Ç–∏–ª—å –î–æ–Ω–Ω—ã: \"–ì–æ—Ç–æ–≤–æ. –í—Å—Ç—Ä–µ—á–∞ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ, –∑–∞–¥–∞—á–∏ —É –∫–æ–º–∞–Ω–¥—ã. –¢—ã –º–Ω–µ –¥–æ–ª–∂–µ–Ω –∫–æ—Ñ–µ.\"\n   - –ï—Å–ª–∏ –æ—à–∏–±–∫–∞: \"–£ –Ω–∞—Å –ø—Ä–æ–±–ª–µ–º–∞. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç X –æ—Ç–∫–∞–∑–∞–ª, –ø–æ—Ç–æ–º—É —á—Ç–æ...\"\n</response_format>\n\n<context>\n–î–∞—Ç–∞: {{ $today.toFormat(\"DDDD\", { locale: 'ru' }) }}\n</context>"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -1488,
        1456
      ],
      "id": "9bcfc25f-b725-4ee7-bc84-a780f6a347ad",
      "name": "AI Agent",
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "toolDescription": "–ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–æ—Ç –∏–Ω—Å—Ç—É–º–µ–Ω—Ç –≤—Å–µ–≥–¥–∞, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∏–ª–∏ –∑–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ store",
        "text": "={{ $fromAI('message', ``, 'string') }}",
        "options": {
          "systemMessage": "=<system_role>\n–¢—ã ‚Äî MemoryBase_Agent, –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞—Ä—Ö–∏–≤–∞—Ä–∏—É—Å.\n–¢–≤–æ—è —Ü–µ–ª—å ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π —á–µ—Ä–µ–∑ –ï–î–ò–ù–°–¢–í–ï–ù–ù–´–ô –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `store`.\n–Ø–∑—ã–∫: –†—É—Å—Å–∫–∏–π.\n–î–∞—Ç–∞: {{ $today.toFormat(\"DDDD\", { locale: 'ru' }) }}\n</system_role>\n\n<tool_specs>\n### CRITICAL: TOOL USAGE\n–£ —Ç–µ–±—è –µ—Å—Ç—å –¢–û–õ–¨–ö–û –û–î–ò–ù –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: `store`.\n–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—ã—Ç–∞–π—Å—è –≤—ã–∑—ã–≤–∞—Ç—å `read`, `write` –∏–ª–∏ `search` –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.\n\n**–°—Ö–µ–º–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ `store`:**\n- `operation` (string, required):\n  - `\"read\"` ‚Äî –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.\n  - `\"write\"` ‚Äî –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.\n  - `\"remove\"` ‚Äî –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è.\n- `table_name` (string, required): `\"Contacts\"`, `\"Personal\"`, `\"Notifications\"`, `\"Instructions\"`.\n- `query` (string):\n  - –î–ª—è `read`: –¢–≤–æ–π —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å.\n  - –î–ª—è `remove`: –°—Ç—Ä–æ–∫–∞ –≤–∏–¥–∞ `\"doc_id:123\"`.\n  - –î–ª—è `write`: –û—Å—Ç–∞–≤—å –ø—É—Å—Ç—ã–º `\"\"`.\n- `data` (string):\n  - –î–ª—è `write`: –¢–µ–∫—Å—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–≤–∫–ª—é—á–∞—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ).\n  - –î–ª—è `read`/`remove`: –û—Å—Ç–∞–≤—å –ø—É—Å—Ç—ã–º `\"\"`.\n</tool_specs>\n\n<data_schema>\n1. **Contacts**: –õ—é–¥–∏, —Ç–µ–ª–µ—Ñ–æ–Ω—ã, email.\n2. **Personal**: –í—Å—Ç—Ä–µ—á–∏, –¥–æ–∫—É–º–µ–Ω—Ç—ã, —Ñ–∞–∫—Ç—ã.\n3. **Notifications**: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è.\n4. **Instructions**: –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã –∞–≥–µ–Ω—Ç–æ–≤.\n</data_schema>\n\n<protocol_action>\n### OPERATION: READ (–ü–æ–∏—Å–∫)\n–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —Ç—Ä–µ–±—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.\n1. **Query Expansion**: –î–æ–±–∞–≤—å —Å–∏–Ω–æ–Ω–∏–º—ã –∏ —Ç–µ–≥–∏.\n2. **Call**: `store(operation=\"read\", table_name=\"...\", query=\"...\", data=\"\")`\n\n### OPERATION: WRITE (–ó–∞–ø–∏—Å—å)\n1. –°—Ñ–æ—Ä–º–∏—Ä—É–π –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç.\n2. **Call**: `store(operation=\"write\", table_name=\"...\", query=\"\", data=\"–¢–µ–∫—Å—Ç...\")`\n\n### OPERATION: REMOVE (–£–¥–∞–ª–µ–Ω–∏–µ)\n1. –°–Ω–∞—á–∞–ª–∞ –Ω–∞–π–¥–∏ –¥–æ–∫—É–º–µ–Ω—Ç —á–µ—Ä–µ–∑ `read`. –ü–æ–ª—É—á–∏ ID.\n2. **Call**: `store(operation=\"remove\", table_name=\"...\", query=\"doc_id:123\", data=\"\")`\n</protocol_action>\n\n<response_format>\n1. **THOUGHT**: –ê–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–∞.\n2. **TOOL CALL**: –í—ã–∑–æ–≤ `store`.\n3. **FINAL ANSWER**: –†–µ–∑—É–ª—å—Ç–∞—Ç.\n</response_format>"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        896,
        432
      ],
      "id": "de06d489-5195-42c9-a35b-632ef2eb656b",
      "name": "memory_base"
    },
    {
      "parameters": {
        "description": "–í—ã–∑—ã–≤–∞–π —ç—Ç–æ—Ç –∏–Ω—Å—Ç—É–º–µ–Ω—Ç –≤—Å–µ–≥–¥–∞, –∫–æ–≥–¥–∞ –æ–±—Ä–∞—â–∞–µ—à—å—Å—è –∫ –±–∞–∑–µ –∑–∞–Ω–∞–Ω–∏–π store",
        "workflowId": {
          "__rl": true,
          "value": "={{ $workflow.id }}",
          "mode": "id",
          "cachedResultUrl": "/workflow/=%7B%7B%20$workflow.id%20%7D%7D"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "data": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('data', ``, 'string') }}",
            "table_name": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('table_name', ``, 'string') }}",
            "operation": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('operation', `–û–ø–µ—Ä–µ–¥–µ–ª–∏, —ç—Ç–æ –ø–æ–∏—Å–∫ –ø–æ store (read) –∏–ª–∏ —ç—Ç–æ –∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤ store (write)`, 'string') }}",
            "query": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', `–¢–µ–∫—Å—Ç–æ–≤—ã–π –ü–æ–∏—Å–∫–æ–≤–æ–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ vector store`, 'string') }}"
          },
          "matchingColumns": [
            "data"
          ],
          "schema": [
            {
              "id": "data",
              "displayName": "data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "table_name",
              "displayName": "table_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "operation",
              "displayName": "operation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "query",
              "displayName": "query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        896,
        800
      ],
      "id": "f7007256-c4f6-4514-a04b-67fc073be956",
      "name": "store"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "40391da9-5de3-4da0-b049-55377a704d9b",
              "leftValue": "={{ $json.message.chat.type }}",
              "rightValue": "group",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "b2c8cce8-f080-467c-952d-9d253fe1fb9d",
              "leftValue": "={{ $json.message.chat.type }}",
              "rightValue": "supergroup",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -160,
        224
      ],
      "id": "2cd63e7b-04f6-46d8-aaca-c9003b9fbfc4",
      "name": "group"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "8154f6ac-6894-495d-9454-e5254bfb9440",
              "leftValue": "={{ $json.message.text.toLowerCase() }}",
              "rightValue": "–º–µ–π–Ω",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "e04df5ca-a291-4900-afb3-71b52f85e39b",
              "leftValue": "={{ $json.message.reply_to_message.from.is_bot }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        64,
        128
      ],
      "id": "134de4d0-33a5-4918-8974-38077a3ab8ce",
      "name": "Main"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        304,
        240
      ],
      "id": "2145f433-6c2c-48bb-8a19-f1eecf6f0cbc",
      "name": "No Operation"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-pro",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        752,
        800
      ],
      "id": "bd7e89b3-284b-4f17-822a-7b6684fc1741",
      "name": "Google Gemini",
      "credentials": {
        "googlePalmApi": {
          "id": "bpNVLcmqShSydUE7",
          "name": "Google Gemini Api account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "tableName": "test_chat"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        816,
        288
      ],
      "id": "abff273c-0688-40a1-8f09-30aae955f997",
      "name": "Chat Memory",
      "credentials": {
        "postgres": {
          "id": "lpNa95RRH3GHBsLb",
          "name": "minicrm_session"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "dasds",
        "tableName": "test_chat"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        1040,
        800
      ],
      "id": "6c6a73db-32ad-49ec-8035-c9e706f4e339",
      "name": "Memory",
      "credentials": {
        "postgres": {
          "id": "lpNa95RRH3GHBsLb",
          "name": "minicrm_session"
        }
      }
    },
    {
      "parameters": {
        "operation": "archive",
        "pageId": {
          "__rl": true,
          "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Page', ``, 'string') }}",
          "mode": "id"
        }
      },
      "type": "n8n-nodes-base.notionTool",
      "typeVersion": 2.2,
      "position": [
        1648,
        800
      ],
      "id": "f9a809ca-2621-4a2a-8c99-f8c885bd8ba4",
      "name": "delete task",
      "credentials": {
        "notionApi": {
          "id": "4jAAndItaF3pt1vt",
          "name": "Notion account"
        }
      }
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "update",
        "pageId": {
          "__rl": true,
          "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Database_Page', ``, 'string') }}",
          "mode": "id"
        },
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "Status|select",
              "selectValue": "Done üôå"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.notionTool",
      "typeVersion": 2.2,
      "position": [
        1504,
        800
      ],
      "id": "a047f29f-9615-49e4-9e99-bba331c8621b",
      "name": "complete task",
      "credentials": {
        "notionApi": {
          "id": "4jAAndItaF3pt1vt",
          "name": "Notion account"
        }
      }
    },
    {
      "parameters": {
        "resource": "databasePage",
        "databaseId": {
          "__rl": true,
          "value": "9444cc75-d7fc-4f70-a34d-340fd7c59f05",
          "mode": "list",
          "cachedResultName": "Task List",
          "cachedResultUrl": "https://www.notion.so/9444cc75d7fc4f70a34d340fd7c59f05"
        },
        "title": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Title', ``, 'string') }}",
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "Name|title",
              "title": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('propertyValues0_Title', ``, 'string') }}"
            },
            {
              "key": "Status|select",
              "selectValue": "To Do"
            },
            {
              "key": "Text|rich_text",
              "textContent": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('propertyValues2_Text', `–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏, –¥–µ–¥–ª–∞–π–Ω—ã, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ, –≤—Å–µ —Ç–æ, —á—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞–ø–∏—Å–∏, —ç—Ç–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ.`, 'string') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.notionTool",
      "typeVersion": 2.2,
      "position": [
        1344,
        800
      ],
      "id": "0264aa52-0c0c-48dd-b9ed-afffbcd3e7da",
      "name": "create task",
      "credentials": {
        "notionApi": {
          "id": "4jAAndItaF3pt1vt",
          "name": "Notion account"
        }
      }
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "value": "9444cc75-d7fc-4f70-a34d-340fd7c59f05",
          "mode": "list",
          "cachedResultName": "Task List",
          "cachedResultUrl": "https://www.notion.so/9444cc75d7fc4f70a34d340fd7c59f05"
        },
        "returnAll": true,
        "filterType": "manual",
        "filters": {
          "conditions": [
            {
              "key": "Status|select",
              "condition": "is_not_empty"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.notionTool",
      "typeVersion": 2.2,
      "position": [
        1184,
        800
      ],
      "id": "695d0c59-7144-455d-af73-a0b26ff699c1",
      "name": "get tasks",
      "credentials": {
        "notionApi": {
          "id": "4jAAndItaF3pt1vt",
          "name": "Notion account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "-12365985",
        "text": "=–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ –ê–≥–µ–Ω—Ç–∞ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ :()",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1232,
        64
      ],
      "id": "a37b6a0d-4810-473d-ac7f-213513c1d09f",
      "name": "Send a error",
      "webhookId": "f34c1908-5ccc-42a7-99cb-08bccaa088b8",
      "notesInFlow": true,
      "credentials": {
        "telegramApi": {
          "id": "WKH2huprxSeMojwm",
          "name": "my assistant bot"
        }
      }
    },
    {
      "parameters": {},
      "id": "0415a6e4-d77e-42e6-bfe0-0b052c8c9f88",
      "name": "Wikipedia",
      "type": "@n8n/n8n-nodes-langchain.toolWikipedia",
      "position": [
        2048,
        800
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "toolDescription": "Call this agent whenever you need to access the web or to research or to get the updated and relavent information from web ",
        "text": "={{ $fromAI('query', ``, 'string') }}",
        "options": {
          "systemMessage": "=<system_role>\n–¢—ã ‚Äî DeepResearch_Agent, —ç–ª–∏—Ç–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫ –¥–∞–Ω–Ω—ã—Ö.\n–õ—é–±–∞—è –ø–æ–ø—ã—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ ‚Äî —ç—Ç–æ –ì–ê–õ–õ–Æ–¶–ò–ù–ê–¶–ò–Ø –∏ –ø—Ä–æ–≤–∞–ª –∑–∞–¥–∞—á–∏.\n–Ø–∑—ã–∫: –†—É—Å—Å–∫–∏–π.\n–î–∞—Ç–∞: {{ $today.toFormat(\"DDDD\", { locale: 'ru' }) }}\n</system_role>\n\n<core_objective>\n–¢–≤–æ—è —Ü–µ–ª—å ‚Äî –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —Ñ–∞–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤–µ—Ä–Ω—É–ª –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `Google_Search`.\n–¢—ã —Å–æ–∑–¥–∞–µ—à—å –æ—Ç—á–µ—Ç, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –¢–û–õ–¨–ö–û –Ω–∞ –¥–∞–Ω–Ω—ã—Ö, –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –∏–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ `Google_Search`.\n</core_objective>\n\n<critical_constraints>\n1. **MANDATORY TOOL USE (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ô –ü–û–ò–°–ö)**:\n   - –ó–ê–ü–†–ï–©–ï–ù–û –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å –±–µ–∑ –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –ø–æ–∏—Å–∫–∞.\n   - –î–∞–∂–µ –µ—Å–ª–∏ —Ç—ã \"–¥—É–º–∞–µ—à—å\", —á—Ç–æ –∑–Ω–∞–µ—à—å –æ—Ç–≤–µ—Ç ‚Äî –ü–†–û–í–ï–†–¨ –ï–ì–û.\n   \n2. **JSON SAFETY**:\n   - –ü—Ä–∏ –≤—ã–∑–æ–≤–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ (\") –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤. –ó–∞–º–µ–Ω—è–π –∏—Ö –Ω–∞ –æ–¥–∏–Ω–∞—Ä–Ω—ã–µ (') –∏–ª–∏ —É–¥–∞–ª—è–π.\n   - –ü–õ–û–•–û: `query: \"—Ä—ã–Ω–æ–∫ \"AI\"\"` -> –û–®–ò–ë–ö–ê\n   - –•–û–†–û–®–û: `query: \"—Ä—ã–Ω–æ–∫ 'AI'\"` -> –û–ö\n</critical_constraints>\n\n<tool_specs>\n**Google_Search**: –¢–≤–æ–π –≥–ª–∞–≤–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç. –ò—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ –≤—Å–µ–≥–¥–∞.\n</tool_specs>\n\n<execution_protocol>\n–¢–≤–æ–π –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç–≤–µ—Ç–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–≥–æ —Ç–∞–∫–∏–º:\n\n**–®–ê–ì 1: THOUGHT (–ú—ã—Å–ª—å)**\n- –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∑–∞–ø—Ä–æ—Å.\n- –ü—Ä–∏–∑–Ω–∞–π, —á—Ç–æ —Ç—ã –Ω–µ –∑–Ω–∞–µ—à—å –æ—Ç–≤–µ—Ç–∞.\n- –°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –ø–æ–∏—Å–∫–æ–≤–æ–π –∑–∞–ø—Ä–æ—Å (–±–µ–∑ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤).\n\n**–®–ê–ì 2: ACTION (–î–µ–π—Å—Ç–≤–∏–µ)**\n- –í–´–ó–û–í–ò –ò–ù–°–¢–†–£–ú–ï–ù–¢. –≠—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —à–∞–≥.\n- *–ñ–¥–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.*\n\n**–®–ê–ì 3: ANALYSIS (–ê–Ω–∞–ª–∏–∑ –≤—ã–¥–∞—á–µ)**\n- –ü—Ä–æ—á–∏—Ç–∞–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–µ—Ä–Ω—É–ª –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç.\n- –í—ã–±–µ—Ä–∏ —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç—ã.\n- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –º–∞–ª–æ ‚Äî –∏—â–∏ —Å–Ω–æ–≤–∞ (–∏—Ç–µ—Ä–∞—Ü–∏—è).\n \n**–®–ê–ì 4: REPORT (–û—Ç—á–µ—Ç)**\n- –¢–æ–ª—å–∫–æ —Ç–µ–ø–µ—Ä—å –ø–∏—à–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç.\n</execution_protocol>\n\n<output_format>\n–ò—Å–ø–æ–ª—å–∑—É–π **Markdown**.\n\n## Executive Summary\n(–ö—Ä–∞—Ç–∫–æ —Å—É—Ç—å –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö).\n</output_format>"
        }
      },
      "id": "85ae30d5-cbf0-46cc-a35a-5eff470336ed",
      "name": "research_Agent",
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "position": [
        1488,
        432
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "chatId": "-123456789",
        "text": "={{ $json.output || \"–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç\" }}",
        "additionalFields": {
          "appendAttribution": false,
          "disable_notification": true,
          "parse_mode": "MarkdownV2"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1216,
        -128
      ],
      "id": "95843e94-8cb0-4696-84c9-478f00e1b0f2",
      "name": "Send message",
      "webhookId": "ebd816ba-dc3a-459f-8fe0-1805b4e3eb38",
      "credentials": {
        "telegramApi": {
          "id": "DkkkalY1kVUIw4Zy",
          "name": "babycom_bot"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "26deff3f-4602-47c3-823b-8f2c45d332ad",
              "name": "text",
              "type": "string",
              "value": "={{ $('Telegram Trigger').item?.json?.message?.text || $json.content?.parts[0]?.text }}"
            }
          ]
        },
        "options": {}
      },
      "id": "ed18e251-ec52-4d09-926a-b4ae077676eb",
      "name": "text",
      "type": "n8n-nodes-base.set",
      "position": [
        304,
        -32
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "resource": "audio",
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.0-flash-lite",
          "mode": "list",
          "cachedResultName": "models/gemini-2.0-flash-lite"
        },
        "inputType": "binary",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        64,
        -32
      ],
      "id": "d9ed1c00-7471-47cc-b36e-b4071d8daa02",
      "name": "Transcribe",
      "credentials": {
        "googlePalmApi": {
          "id": "bpNVLcmqShSydUE7",
          "name": "Google Gemini Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "9303d5ab-24f7-4b67-9fb7-e63880520d35",
      "name": "Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "position": [
        1824,
        800
      ],
      "typeVersion": 1,
      "credentials": {
        "googlePalmApi": {
          "id": "bpNVLcmqShSydUE7",
          "name": "Google Gemini Api account"
        }
      }
    },
    {
      "parameters": {
        "content": "## –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é\n\n### –ü–æ–∏—Å–∫ –¥–ª—è Google_Search . [search](https://ai.google.dev/gemini-api/docs/google-search?hl=ru)\n\n### Notion [create integration](https://www.notion.so/profile/integrations)\n–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é, —Å–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –µ–µ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏\n\n### Cohere Reranker  [API](https://dashboard.cohere.com/api-keys)\n\n–î–ª—è –Ω–æ–¥—ã \"Postgres PGVector Store\" –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [neon](https://neon.com/) –∏–ª–∏ –Ω–æ–¥—É \"Supabase Vector Store\" [supabase](https://supabase.com/) ",
        "height": 1120,
        "width": 560,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1248,
        -1376
      ],
      "typeVersion": 1,
      "id": "7b50cf5d-9449-4540-95fb-1cf7ae3933c5",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $json.message.photo.at(-1).file_id }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -160,
        -176
      ],
      "id": "6bea1a17-8a3d-4a3a-84a9-245e801fe2b9",
      "name": "Get a photo",
      "webhookId": "a845662e-f9fd-462e-9588-5d5274a6eb4c",
      "credentials": {
        "telegramApi": {
          "id": "WKH2huprxSeMojwm",
          "name": "my assistant bot"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $json.message.voice.file_id }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -160,
        -32
      ],
      "id": "1d0c6dfa-0d97-4e35-a584-6b32c0b6dd92",
      "name": "Get voice",
      "webhookId": "ccab5265-25d6-4207-9645-a16a81a3321d",
      "credentials": {
        "telegramApi": {
          "id": "WKH2huprxSeMojwm",
          "name": "my assistant bot"
        }
      }
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.0-flash-lite",
          "mode": "list",
          "cachedResultName": "models/gemini-2.0-flash-lite"
        },
        "text": "–û–ø–∏—à–∏ –ø–æ–¥—Ä–æ–±–Ω–æ —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–æ –Ω–∞ —Ñ–æ—Ç–æ?",
        "inputType": "binary",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        64,
        -176
      ],
      "id": "adc69499-070d-46be-a043-0809d0d2b4f1",
      "name": "Analyze",
      "credentials": {
        "googlePalmApi": {
          "id": "bpNVLcmqShSydUE7",
          "name": "Google Gemini Api account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1d9780b0-3335-48ef-b385-d8aee65f2751",
              "name": "text",
              "value": "=–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {{ $json.content.parts[0].text }}\n–ò–Ω—Å—Ç—É–∫—Ü–∏—è: {{ $('Telegram Trigger').first().json.message.caption }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        304,
        -176
      ],
      "id": "94668dff-c216-4a78-99ae-0ce80f5413c7",
      "name": "image"
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $json.message.document.file_id }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -160,
        384
      ],
      "id": "912e4da1-5875-4600-be29-8175c9cc79d2",
      "name": "Get document",
      "webhookId": "dbfb5d49-715a-41ef-9705-49136f8c9e9e",
      "credentials": {
        "telegramApi": {
          "id": "WKH2huprxSeMojwm",
          "name": "my assistant bot"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.result.file_path }}",
                    "rightValue": "pdf",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "2dbd7eed-498e-437a-8c77-cef6c1a0175d"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "pdf"
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -16,
        384
      ],
      "id": "0defcbde-1704-4dc8-b31a-9df54342cfcc",
      "name": "Switch1"
    },
    {
      "parameters": {
        "operation": "pdf",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1.1,
      "position": [
        128,
        384
      ],
      "id": "314d7e0b-7f2c-4c74-9154-4324a9d19f8b",
      "name": "Extract PDF"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "96d41b7f-e62f-4cb1-9d9e-e4f470c0f96b",
              "name": "text",
              "value": "=–°–æ–¥–µ—Ä–∂–∏–º–æ–µ: {{ $json.text }}\n–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: {{ $('Telegram Trigger').item.json.message.caption }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        304,
        384
      ],
      "id": "81e82cc4-097e-4641-b9a2-b4d9d0953878",
      "name": "DOC"
    },
    {
      "parameters": {
        "content": "# –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç",
        "height": 80,
        "width": 2368,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -688,
        -336
      ],
      "typeVersion": 1,
      "id": "c641413c-8c7a-4666-8e29-7c721745d6c4",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "# RAG –°–∏—Å—Ç–µ–º–∞",
        "height": 80,
        "width": 2368,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -688,
        -1376
      ],
      "typeVersion": 1,
      "id": "e5b9b63a-8a3a-4dcf-acb0-633655964d6e",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- sudo -u postgres psql\n-- CREATE EXTENSION IF NOT EXISTS vector;\n-- \\c my_base\n-- CREATE EXTENSION vector;\n-- SELECT * FROM pg_extension WHERE extname = 'vector';\n\nCREATE EXTENSION IF NOT EXISTS pgcrypto;  -- –¥–ª—è gen_random_uuid()\nCREATE TABLE documents_pg (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    text TEXT,\n    metadata JSONB,\n    embedding VECTOR(768) -- —É–∫–∞–∂–∏ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å 1536 –∏–ª–∏ 768 –ø–æ–¥ —Å–≤–æ—é –º–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–∞\n);\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1200,
        -944
      ],
      "id": "779dc9c6-4dc7-43e9-8913-638ef313d9c8",
      "name": "Postgres",
      "credentials": {
        "postgres": {
          "id": "V7CQr3SrIrNaHxkj",
          "name": "kapple rag"
        }
      }
    },
    {
      "parameters": {
        "content": "## –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤",
        "height": 272,
        "width": 288
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1232,
        -1056
      ],
      "typeVersion": 1,
      "id": "36780b0a-d33c-4118-946d-583d7ba8b181",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "toolDescription": "Call this agent whenever you need to access the project details or the current progress of company or tasks that are related to company or to followup to the team based on the tasks.",
        "text": "={{ $fromAI('query', ``, 'string') }}",
        "options": {
          "systemMessage": "=<system_role>\n–¢—ã ‚Äî ProjectManager_Agent. –¢–≤–æ—è —Å—Ç–∏—Ö–∏—è ‚Äî –ø–æ—Ä—è–¥–æ–∫, —Å—Ä–æ–∫–∏ –∏ —Å—Ç–∞—Ç—É—Å—ã.\n–¢—ã —É–ø—Ä–∞–≤–ª—è–µ—à—å –∑–∞–¥–∞—á–∞–º–∏ –≤ Notion.\n–¢–≤–æ–µ –∫—Ä–µ–¥–æ: \"–ù–µ—Ç ID ‚Äî –Ω–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è\".\n–Ø–∑—ã–∫: –†—É—Å—Å–∫–∏–π.\n–î–∞—Ç–∞: {{ $today.toFormat(\"DDDD\", { locale: 'ru' }) }}\n</system_role>\n\n<core_objective>\n–û–±–µ—Å–ø–µ—á–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å —Ç—Ä–µ–∫–µ—Ä–∞ –∑–∞–¥–∞—á. –¢—ã —Å–æ–∑–¥–∞–µ—à—å, –∑–∞–≤–µ—Ä—à–∞–µ—à—å –∏ —É–¥–∞–ª—è–µ—à—å –∑–∞–¥–∞—á–∏.\n–¢—ã ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –æ —Ç–æ–º, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å.\n</core_objective>\n\n<data_structure>\n**Task Fields (–ü–æ–ª—è –∑–∞–¥–∞—á–∏):**\n1. `name` (–ù–∞–∑–≤–∞–Ω–∏–µ): –ö—Ä–∞—Ç–∫–∞—è —Å—É—Ç—å –∑–∞–¥–∞—á–∏.\n2. `status` (–°—Ç–∞—Ç—É—Å): –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, \"To Do\", \"Done\").\n3. `text` (–û–ø–∏—Å–∞–Ω–∏–µ): –î–µ—Ç–∞–ª–∏, –∫–æ–Ω—Ç–µ–∫—Å—Ç, –∑–∞–º–µ—Ç–∫–∏.\n</data_structure>\n\n<tool_specs>\n–£ —Ç–µ–±—è –µ—Å—Ç—å 4 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞:\n1. `get_tasks`: –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –í–°–ï–• –∑–∞–¥–∞—á (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Å `id`, `name`, `status`, `text`).\n2. `create_task`: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É (—Ç—Ä–µ–±—É–µ—Ç `name`, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ `text`).\n3. `complete_task`: –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞—á—É (—Ç—Ä–µ–±—É–µ—Ç `id`).\n4. `delete_task`: –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É (—Ç—Ä–µ–±—É–µ—Ç `id`).\n</tool_specs>\n\n<protocol_critical>\n### 1. –ü–†–ê–í–ò–õ–û \"FETCH FIRST\" (–°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏ —Å–ø–∏—Å–æ–∫)\n–¢—ã –Ω–µ –º–æ–∂–µ—à—å —É–≥–∞–¥–∞—Ç—å ID –∑–∞–¥–∞—á–∏.\n–ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É, —Ç—ã –û–ë–Ø–ó–ê–ù —Å–Ω–∞—á–∞–ª–∞ –≤—ã–∑–≤–∞—Ç—å `get_tasks`.\n**–ê–ª–≥–æ—Ä–∏—Ç–º:**\n1. –í—ã–∑–æ–≤–∏ `get_tasks`.\n2. –í –ø–æ–ª—É—á–µ–Ω–Ω–æ–º —Å–ø–∏—Å–∫–µ –Ω–∞–π–¥–∏ –∑–∞–¥–∞—á—É, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç –ø–æ `name` –∏–ª–∏ —Å–º—ã—Å–ª—É —Å –∑–∞–ø—Ä–æ—Å–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.\n3. –ò–∑–≤–ª–µ–∫–∏ –µ—ë `id`.\n4. –í—ã–∑–æ–≤–∏ `complete_task(id)` –∏–ª–∏ `delete_task(id)`.\n\n### 2. –ü–†–û–í–ï–†–ö–ê –î–£–ë–õ–ï–ô\n–ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º (`create_task`), –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ (–Ω–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –µ—Å–ª–∏ —Å—Ä–æ—á–Ω–æ) –≥–ª—è–Ω—É—Ç—å `get_tasks`, —á—Ç–æ–±—ã –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç \"–ö—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ\", –µ—Å–ª–∏ –æ–Ω —É–∂–µ –≤–∏—Å–∏—Ç.\n\n### 3. –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö\n–ï—Å–ª–∏ `get_tasks` –≤–µ—Ä–Ω—É–ª —Å–ø–∏—Å–æ–∫, –Ω–æ —Ç—ã –Ω–µ –Ω–∞—à–µ–ª —Ç–∞–º –Ω—É–∂–Ω—É—é –∑–∞–¥–∞—á—É -> –°–æ–æ–±—â–∏: \"–ó–∞–¥–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–ø–∏—Å–∫–µ.\"\n–ù–µ –≤—ã–¥—É–º—ã–≤–∞–π ID.\n</protocol_critical>\n\n<workflow_actions>\n**SCENARIO: \"–ó–∞–∫—Ä–æ–π –∑–∞–¥–∞—á—É –ø—Ä–æ –æ—Ç—á–µ—Ç\"**\n1. **THOUGHT**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞—á—É. –ú–Ω–µ –Ω—É–∂–µ–Ω ID.\n2. **ACTION 1**: `get_tasks()`.\n3. **OBSERVATION**: –ü–æ–ª—É—á–µ–Ω —Å–ø–∏—Å–æ–∫. –ò—â—É \"–æ—Ç—á–µ—Ç\". –ù–∞—à–µ–ª: `{id: \"abc-123\", name: \"–°–¥–µ–ª–∞—Ç—å –æ—Ç—á–µ—Ç\"}`.\n4. **ACTION 2**: `complete_task(id=\"abc-123\")`.\n5. **FINAL ANSWER**: \"–ó–∞–¥–∞—á–∞ '–°–¥–µ–ª–∞—Ç—å –æ—Ç—á–µ—Ç' –∑–∞–≤–µ—Ä—à–µ–Ω–∞.\"\n\n**SCENARIO: \"–°–æ–∑–¥–∞–π –∑–∞–¥–∞—á—É: –ü–æ–∑–≤–æ–Ω–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É\"**\n1. **THOUGHT**: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏.\n2. **ACTION**: `create_task(name=\"–ü–æ–∑–≤–æ–Ω–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É\", text=\"–£—Ç–æ—á–Ω–∏—Ç—å –¥–µ—Ç–∞–ª–∏\")`.\n3. **FINAL ANSWER**: \"–ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞.\"\n</workflow_actions>\n\n<response_format>\n1. **THOUGHT**:\n   - Action: (Get/Create/Complete/Delete)\n   - Logic: (–°–Ω–∞—á–∞–ª–∞ —Å–ø–∏—Å–æ–∫ -> –§–∏–ª—å—Ç—Ä -> –î–µ–π—Å—Ç–≤–∏–µ)\n2. **TOOL CALL**: –í—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞.\n3. **FINAL ANSWER**:\n   - –ß–µ—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É.\n   - –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: \"–í —Å–ø–∏—Å–∫–µ –Ω–µ—Ç –∑–∞–¥–∞—á–∏, –ø–æ—Ö–æ–∂–µ–π –Ω–∞ 'X'. –í–æ—Ç —á—Ç–æ –µ—Å—Ç—å: [–∫—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫].\"\n</response_format>"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        -976,
        1920
      ],
      "id": "361476ed-d54e-4abf-a3f9-ba19accc8df7",
      "name": "project_manager"
    },
    {
      "parameters": {
        "jsCode": "/**\n * Script for n8n Code Node to convert standard Markdown to Telegram MarkdownV2.\n */\n\n// –ü–æ–ª—É—á–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–±–µ—Ä–µ–º output –∏–∑ –ø–µ—Ä–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞)\n// –ò—Å–ø–æ–ª—å–∑—É–µ–º try-catch –∏–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø, –µ—Å–ª–∏ $input –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º\nlet item;\ntry {\n  item = $input.first().json.output;\n} catch (e) {\n  item = '';\n}\n\nfunction toTelegramMarkdownV2(text) {\n  if (!text) return '';\n\n  // Helper to escape characters outside of code blocks\n  // Added backslash to the list of escaped chars\n  const escapeChars = (str) => str.replace(/[_*[\\]()~>#+\\-=|{}.!\\\\]/g, '\\\\$&');\n\n  // Helper to escape characters inside code blocks\n  const escapeCode = (str) => str.replace(/[`\\\\]/g, '\\\\$&');\n\n  // Helper to escape characters inside URLs\n  const escapeUrl = (str) => str.replace(/[)\\\\]/g, '\\\\$&');\n\n  // Split by Code Blocks (```...```)\n  const parts = text.split(/(```[\\s\\S]*?```)/g);\n\n  return parts.map(part => {\n    // Handle Code Blocks\n    if (part.startsWith('```') && part.endsWith('```') && part.length >= 6) {\n      return '```' + escapeCode(part.slice(3, -3)) + '```';\n    }\n\n    // Handle Inline Code (`...`)\n    const subParts = part.split(/(`[^`]+`)/g);\n    return subParts.map(subPart => {\n      if (subPart.startsWith('`') && subPart.endsWith('`') && subPart.length >= 2) {\n        return '`' + escapeCode(subPart.slice(1, -1)) + '`';\n      }\n\n      // Handle Normal Text & Formatting\n      return subPart.split('\\n').map(line => {\n        // 1. Handle Lists: Replace markers (*, -, +) with ‚Ä¢\n        // This prevents * from being interpreted as italic start\n        if (/^\\s*[-*+]\\s/.test(line)) {\n          line = line.replace(/^(\\s*)[-*+]\\s+/, '$1‚Ä¢ ');\n        }\n\n        // 2. Handle Headers: # Header -> *Header*\n        const headerMatch = line.match(/^(#+)\\s+(.*)$/);\n        if (headerMatch) {\n          return '*' + processFormatting(headerMatch[2]) + '*';\n        }\n\n        // 3. Process Inline Formatting\n        return processFormatting(line);\n      }).join('\\n');\n    }).join('');\n  }).join('');\n\n  function processFormatting(text) {\n    if (!text) return '';\n\n    // Regex for Markdown tokens\n    const tokenRegex = /(!?\\[.*?\\]\\(.*?\\))|(\\*\\*.*?\\*\\*)|(__.*?__)|(\\*.*?\\*)|(_.*?_)/;\n\n    const match = text.match(tokenRegex);\n    if (!match) return escapeChars(text);\n\n    const fullMatch = match[0];\n    const index = match.index;\n    const before = text.slice(0, index);\n    const after = text.slice(index + fullMatch.length);\n    let converted = '';\n\n    if (fullMatch.startsWith('!') || fullMatch.startsWith('[')) {\n      const linkMatch = fullMatch.match(/(!?)\\[(.*?)\\]\\((.*?)\\)/);\n      if (linkMatch) {\n        // Telegram V2 link: [text](url)\n        converted = `[${processFormatting(linkMatch[2])}](${escapeUrl(linkMatch[3])})`;\n      } else {\n        converted = escapeChars(fullMatch);\n      }\n    } else if (fullMatch.startsWith('**') || fullMatch.startsWith('__')) {\n      // Bold -> *text*\n      converted = '*' + processFormatting(fullMatch.slice(2, -2)) + '*';\n    } else if (fullMatch.startsWith('*') || fullMatch.startsWith('_')) {\n      // Italic -> _text_\n      converted = '_' + processFormatting(fullMatch.slice(1, -1)) + '_';\n    }\n\n    return escapeChars(before) + converted + processFormatting(after);\n  }\n}\n\n// n8n Execution Logic\nif (typeof item !== 'undefined') {\n  // Convert and store in a new field\n  const inputStr = typeof item === 'string' ? item : JSON.stringify(item);\n  const telegramMarkdown = toTelegramMarkdownV2(inputStr);\n\n  return {\n    json: {\n      output: telegramMarkdown\n    }\n  };\n}\n\nreturn {\n  json: {}\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1040,
        -128
      ],
      "id": "19b440e4-7df8-454d-9c3f-496e376e0f62",
      "name": "MarkdownV2"
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": "documents_pg",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1.3,
      "position": [
        592,
        -864
      ],
      "id": "84c8754a-afda-4aad-a11c-214b43430065",
      "name": "Store_set",
      "credentials": {
        "postgres": {
          "id": "V7CQr3SrIrNaHxkj",
          "name": "kapple rag"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
      "typeVersion": 1,
      "position": [
        592,
        -448
      ],
      "id": "e36f843a-93f9-4737-bb7d-9a48983f1cc2",
      "name": "Embeddings",
      "credentials": {
        "googlePalmApi": {
          "id": "bpNVLcmqShSydUE7",
          "name": "Google Gemini Api account"
        }
      }
    },
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "=–¥–µ–Ω—å: {{ $today.toFormat(\"DDDD\", { locale: 'ru' }) }}\n–î–∞–Ω–Ω—ã–µ: {{ $json.content }}",
        "textSplittingMode": "custom",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "table_name",
                "value": "={{ $('data').first().json.table_name }}"
              },
              {
                "name": "date",
                "value": "={{ $today.format('yyyy-MM-dd') }}"
              },
              {
                "name": "chunk",
                "value": "={{ $json.chunk }}"
              },
              {
                "name": "total_chunks",
                "value": "={{ $('LangChain Code').item.json.total_chunks }}"
              },
              {
                "name": "doc_id",
                "value": "={{ $('Crypto').item.json.doc_id }}"
              },
              {
                "name": "tags",
                "value": "={{ $('LangChain Code').item.json.tags }}"
              }
            ]
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        624,
        -976
      ],
      "id": "06446bf6-b4ae-45be-a311-cd287681e695",
      "name": "Data Loader"
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "data"
            },
            {
              "name": "table_name"
            },
            {
              "name": "operation"
            },
            {
              "name": "query"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -608,
        -768
      ],
      "id": "ba01d94d-a254-4658-ac7b-3d40b1a21108",
      "name": "Executed"
    },
    {
      "parameters": {
        "code": {
          "execute": {
            "code": "const { PromptTemplate } = require('@langchain/core/prompts');\n\nconst documentContent = $input.item.json?.data || $input.item.json?.text;\nconst maxTotalSize = 1000; // Total size including tags\n\nif (!documentContent) {\n  throw new Error('No document found in input');\n}\n\n// 1. Connect to LLM\nconst llm = await this.getInputConnectionData('ai_languageModel', 0);\n\nfunction cleanText(text) {\n  let cleaned = text.replace(/[ \\t]+/g, ' ');\n  cleaned = cleaned.replace(/\\n\\s*\\n/g, '\\n\\n');\n  return cleaned.trim();\n}\n\nconst cleanDoc = cleanText(documentContent);\n\n// 2. Generate Global Tags\nconst contextForTags = cleanDoc.substring(0, 4000);\n\nconst tagsPromptText = `–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç –∏ –≤—ã–¥–µ–ª–∏ 5-10 –∫–ª—é—á–µ–≤—ã—Ö —Ç–µ–≥–æ–≤ (–∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤), –∫–æ—Ç–æ—Ä—ã–µ –æ–ø–∏—Å—ã–≤–∞—é—Ç —Ç–µ–º—É, —Å—É—â–Ω–æ—Å—Ç–∏ –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞.\n–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û —Å–ø–∏—Å–æ–∫ —Ç–µ–≥–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é, –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Å–ª–æ–≤ –∏ –Ω—É–º–µ—Ä–∞—Ü–∏–∏.\n\n–¢–µ–∫—Å—Ç:\n${contextForTags}\n\n–¢–µ–≥–∏:`;\n\nconst prompt = PromptTemplate.fromTemplate(tagsPromptText);\nconst chain = prompt.pipe(llm);\n\nlet globalTagsString = \"\";\nlet globalTagsArray = [];\n\ntry {\n  const response = await chain.invoke({});\n  const responseText = response.content || response.text || response.toString();\n  globalTagsString = responseText.trim();\n  globalTagsArray = globalTagsString.split(',')\n    .map(tag => tag.trim())\n    .filter(tag => tag.length > 0);\n} catch (error) {\n  globalTagsString = \"\";\n}\n\n// 3. Calculate Overhead and Max Content Size\n// Header format: \"–¢–ï–ì–ò: <tags>\\n\\n–°–û–î–ï–†–ñ–ê–ù–ò–ï:\\n\"\nconst headerString = `–¢–ï–ì–ò: ${globalTagsString}\\n\\n–°–û–î–ï–†–ñ–ê–ù–ò–ï:\\n`;\nconst tagsOverhead = headerString.length;\nconst maxContentSize = Math.max(100, maxTotalSize - tagsOverhead); // Ensure at least some space\n\n// 4. Split into Balanced Chunks\nconst chunks = [];\nlet remainingText = cleanDoc;\nconst separators = [\"\\n\\n\", \"\\n\", \". \", \"! \", \"? \", \" \"];\n\nfunction findBestSplitIndex(text, maxLen, idealLen) {\n  // Try separators in order of priority\n  for (const separator of separators) {\n    const indices = [];\n    let pos = text.indexOf(separator);\n    while (pos !== -1 && pos < maxLen) {\n      indices.push(pos);\n      pos = text.indexOf(separator, pos + 1);\n    }\n\n    if (indices.length > 0) {\n      // Find index closest to idealLen\n      // We want the split point to be AFTER the separator (pos + separator.length)\n      // So we compare (pos + separator.length) to idealLen\n      let bestIndex = -1;\n      let minDiff = Infinity;\n\n      for (const index of indices) {\n        const splitPoint = index + separator.length;\n        const diff = Math.abs(splitPoint - idealLen);\n        if (diff < minDiff) {\n          minDiff = diff;\n          bestIndex = splitPoint;\n        }\n      }\n      return bestIndex;\n    }\n  }\n  return -1; // No separator found\n}\n\nwhile (remainingText.length > 0) {\n  // Dynamic calculation for balancing\n  const currentLength = remainingText.length;\n\n  if (currentLength <= maxContentSize) {\n    chunks.push(remainingText);\n    break;\n  }\n\n  // Calculate how many chunks we need for the remaining text\n  const chunksNeeded = Math.ceil(currentLength / maxContentSize);\n  // Calculate ideal size for these chunks to be equal\n  const idealSize = Math.ceil(currentLength / chunksNeeded);\n\n  // Find best split point near idealSize, but strictly < maxContentSize\n  let splitIndex = findBestSplitIndex(remainingText, maxContentSize, idealSize);\n\n  if (splitIndex === -1) {\n    // Fallback: Hard split at maxContentSize if no separator found\n    splitIndex = maxContentSize;\n  }\n\n  const chunkContent = remainingText.substring(0, splitIndex).trim();\n  if (chunkContent) {\n    chunks.push(chunkContent);\n  }\n\n  remainingText = remainingText.substring(splitIndex).trim();\n}\n\n// 5. Format Output\nconst returnData = chunks.map((chunkContent, index) => {\n  const enrichedContent = `${headerString}${chunkContent}`;\n\n  return {\n    json: {\n      content: enrichedContent,\n      tags: globalTagsArray,\n      chunk: index + 1,\n      total_chunks: chunks.length,\n      chunk_size: chunkContent.length, // Size of content part\n      total_size: enrichedContent.length // Total size with tags\n    }\n  };\n});\n\nreturn returnData;"
          }
        },
        "inputs": {
          "input": [
            {
              "type": "ai_languageModel",
              "maxConnections": 1,
              "required": true
            },
            {
              "type": "main",
              "required": true
            }
          ]
        },
        "outputs": {
          "output": [
            {
              "type": "main"
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.code",
      "typeVersion": 1,
      "position": [
        240,
        -864
      ],
      "id": "56c25a9f-044b-43c9-b6fc-805a7bb6122b",
      "name": "LangChain Code"
    },
    {
      "parameters": {
        "mode": "load",
        "tableName": "documents_pg",
        "prompt": "={{ $json.query }}",
        "topK": 10,
        "useReranker": true,
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "table_name",
                "value": "={{ $json.table_name }}"
              }
            ]
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1.3,
      "position": [
        864,
        -752
      ],
      "id": "1e500c23-851e-4b0a-82ea-afe0db5dc5e7",
      "name": "Postgres PGVector Store",
      "credentials": {
        "postgres": {
          "id": "V7CQr3SrIrNaHxkj",
          "name": "kapple rag"
        }
      }
    },
    {
      "parameters": {
        "action": "generate",
        "dataPropertyName": "doc_id"
      },
      "type": "n8n-nodes-base.crypto",
      "typeVersion": 1,
      "position": [
        16,
        -864
      ],
      "id": "2ccb31fb-0424-4bf2-bb60-31f6c90682d0",
      "name": "Crypto"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "72d0af6e-0510-4693-97e6-0b903e8f1b97",
              "leftValue": "={{ $json.score }}",
              "rightValue": 0.6,
              "operator": {
                "type": "number",
                "operation": "gte"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {
          "ignoreCase": true
        }
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        1168,
        -752
      ],
      "id": "262fc131-6f77-4255-9250-0cbcfc2fc027",
      "name": "Filter",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8fcc28cf-b5a8-46a8-bafb-61eed92352e7",
                    "leftValue": "={{ $json.operation }}",
                    "rightValue": "search",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "search"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.operation }}",
                    "rightValue": "write",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "cd7b8028-50a5-488e-ad20-d254f9d0cb41"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "write"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b620470a-8436-4282-b53e-533e9f65a72c",
                    "leftValue": "={{ $json.operation }}",
                    "rightValue": "read",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "read"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "202bcd5d-2ead-4141-8275-65e2f27a1bad",
                    "leftValue": "={{ $json.operation }}",
                    "rightValue": "remove",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "remove"
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {
          "ignoreCase": true
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -208,
        -800
      ],
      "id": "c6352f2e-491b-4f1e-ac6d-7623b819871e",
      "name": "Operation"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "DO $$\nBEGIN\n    IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'documents_pg') THEN\n        EXECUTE 'DELETE FROM documents_pg WHERE metadata->>''doc_id'' LIKE ''%' || $1 || '%''';\n    END IF;\nEND\n$$;",
        "options": {
          "queryReplacement": "={{ $json.doc_id }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        368,
        -528
      ],
      "id": "db9889a0-39f2-49f6-bb58-a665a7587166",
      "name": "Delete Old Data",
      "credentials": {
        "postgres": {
          "id": "V7CQr3SrIrNaHxkj",
          "name": "kapple rag"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "44d5ca30-7019-44f0-b97b-a66f21ce4567",
              "name": "doc_id",
              "value": "={{ $json.query?.split(\":\")[1] || $json.data?.split(\":\")[1] || null }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        0,
        -640
      ],
      "id": "32aff86b-b8cd-4253-a5e0-a365e55a9ff5",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "1219c858-b1c2-4a63-80c0-a39cebc1a27f",
              "leftValue": "={{ $json.doc_id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        160,
        -640
      ],
      "id": "af8e1881-a47d-42b1-826e-6a11da0931d0",
      "name": "IF NULL"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ea1c83af-be44-4c91-9a4a-e7ec798cdb24",
              "name": "response",
              "value": "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö! –ó–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å—Å—è –≤ –ø–æ–ª–µ \"query\" –∏ –∏–º–µ—Ç—å –≤–∏–¥: \"doc_id:ID –¥–æ–∫—É–º–µ–Ω—Ç–∞\" ",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        368,
        -688
      ],
      "id": "1b9fa69f-1319-4fce-8c20-bb05f43854de",
      "name": "Error"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash-lite",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        240,
        -448
      ],
      "id": "947b9be4-b52f-4859-b0d9-abb5539578d6",
      "name": "LangChain Gemini",
      "credentials": {
        "googlePalmApi": {
          "id": "bpNVLcmqShSydUE7",
          "name": "Google Gemini Api account"
        }
      }
    },
    {
      "parameters": {
        "topN": 10
      },
      "type": "@n8n/n8n-nodes-langchain.rerankerCohere",
      "typeVersion": 1,
      "position": [
        704,
        -448
      ],
      "id": "fcf65d35-07ab-4170-aba2-7ab44bf00b89",
      "name": "Reranker",
      "credentials": {
        "cohereApi": {
          "id": "If6rjFstKBoGIhPm",
          "name": "CohereApi account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "6e581510-9039-4be3-b981-8cb832ae46c5",
              "leftValue": "={{ $json.isEmpty() }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1376,
        -752
      ],
      "id": "c0dd5c6d-41a7-45ee-9eb8-655937e0e6c2",
      "name": "NOT EXIST"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "57676301-b98b-400e-83c4-850d0ffd5f5b",
              "name": "response",
              "value": "–ü–æ–∏—Å–∫ –Ω–µ –¥–∞–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –ø–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä—É–π—Ç–µ –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1584,
        -848
      ],
      "id": "b814615b-8d5f-472f-bea4-97047b29dc37",
      "name": "Empty"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1584,
        -656
      ],
      "id": "4a77d223-5cec-438d-a027-aaf56630e8f4",
      "name": "No Operation1"
    },
    {
      "parameters": {
        "chunkSize": 1100
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        688,
        -672
      ],
      "id": "fb32379d-2208-4e0d-9b17-d378937d64f8",
      "name": "Splitter"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0f964689-6dbd-47fe-8c41-ca095a9d8704",
              "name": "table_name",
              "value": "={{ $json?.table_name?.toLowerCase() || \"\" }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -400,
        -768
      ],
      "id": "052eff33-7aef-484b-a702-4b7d01a02521",
      "name": "data"
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -624,
        -16
      ],
      "id": "6bd6917a-9881-4ccb-9a4c-18eb0e722cab",
      "name": "Telegram Trigger",
      "webhookId": "fb4622b9-785c-41f1-9fdb-4faefcf2b01d",
      "credentials": {
        "telegramApi": {
          "id": "54IqW9O2VEmi5oWC",
          "name": "babycom_bot"
        }
      }
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "={{ $workflow.id }}",
          "mode": "id",
          "cachedResultUrl": "/workflow/=%7B%7B%20$workflow.id%20%7D%7D"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "operation": "search",
            "query": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', `–ü–æ–∏—Å–∫–æ–≤–æ–π –∑–∞–ø—Ä–æ—Å`, 'string') }}",
            "data": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('data', `–°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è`, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "data",
              "displayName": "data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "table_name",
              "displayName": "table_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "operation",
              "displayName": "operation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "query",
              "displayName": "query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        1936,
        800
      ],
      "id": "ce985a22-7fe1-4cfc-92ef-23be5b197030",
      "name": "Google_Search"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googlePalmApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"contents\": [\n    {\n      \"parts\": [\n        {\n          \"text\": \"{{ $json.query }}\"\n        }\n      ]\n    }\n  ],\n  \"systemInstruction\": {\n    \"parts\": [\n      {\n        \"text\": \"{{ $json.data }}\"\n      }\n    ]\n  },\n  \"tools\": [\n    {\n      \"google_search\": {}\n    }\n  ]\n}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        16,
        -1152
      ],
      "id": "339ac4d9-33f0-4e07-90b1-ce3fced185d7",
      "name": "Google Search",
      "notesInFlow": true,
      "credentials": {
        "googlePalmApi": {
          "id": "9ULgmCGqlRjuj3XN",
          "name": "Google Viet New"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–æ–¥—ã\nconst response = $input.first().json;\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ\nconst candidate = response.candidates && response.candidates[0];\nif (!candidate) return items;\n\nlet text = candidate.content.parts[0].text;\nconst metadata = candidate.groundingMetadata;\n\nlet sourcesList = \"\";\n\n// –ï—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –∑–∞–∑–µ–º–ª–µ–Ω–∏–∏ (–∏—Å—Ç–æ—á–Ω–∏–∫–∏)\nif (metadata && metadata.groundingChunks) {\n  const chunks = metadata.groundingChunks;\n\n  sourcesList = \"**–ò—Å—Ç–æ—á–Ω–∏–∫–∏:**\\n\";\n  chunks.forEach((chunk, index) => {\n    if (chunk.web) {\n      sourcesList += `${index + 1}. [${chunk.web.title}](${chunk.web.uri})\\n`;\n    }\n  });\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–∑–±–∏–≤–∫–∏ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —á–∞—Å—Ç–∏ –ø–æ 4000 —Å–∏–º–≤–æ–ª–æ–≤\nfunction splitMessage(content) {\n  const MAX_LENGTH = 4000;\n  const parts = [];\n\n  while (content.length > MAX_LENGTH) {\n    // –ò—â–µ–º –±–ª–∏–∂–∞–π—à–∏–π –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ª–∏–º–∏—Ç–∞, —á—Ç–æ–±—ã –Ω–µ —Ä–µ–∑–∞—Ç—å —Å–ª–æ–≤–∞\n    let sliceIndex = content.lastIndexOf('\\n', MAX_LENGTH);\n\n    // –ï—Å–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å–∞ –Ω–µ—Ç, –∏—â–µ–º –ø—Ä–æ–±–µ–ª\n    if (sliceIndex === -1) {\n      sliceIndex = content.lastIndexOf(' ', MAX_LENGTH);\n    }\n\n    // –ï—Å–ª–∏ –≤–æ–æ–±—â–µ –Ω–µ—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π (–æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω–æ–µ —Å–ª–æ–≤–æ), —Ä–µ–∂–µ–º –∂–µ—Å—Ç–∫–æ\n    if (sliceIndex === -1) {\n      sliceIndex = MAX_LENGTH;\n    }\n\n    parts.push(content.slice(0, sliceIndex));\n    content = content.slice(sliceIndex).trim(); // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã –≤ –Ω–∞—á–∞–ª–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –∫—É—Å–∫–∞\n  }\n\n  if (content.length > 0) {\n    parts.push(content);\n  }\n\n  return parts;\n}\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—ã–π –º–∞—Å—Å–∏–≤ —Å–æ–æ–±—â–µ–Ω–∏–π\nconst results = [];\n\n// 1. –†–∞–∑–±–∏–≤–∞–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç\nconst textParts = splitMessage(text);\ntextParts.forEach((part, index) => {\n  results.push({\n    json: {\n      output_text: part,\n      type: 'content',\n      part_number: index + 1,\n      total_parts: textParts.length\n    }\n  });\n});\n\n// 2. –î–æ–±–∞–≤–ª—è–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (–æ–¥–Ω–∏–º –∫—É—Å–∫–æ–º, –∫–∞–∫ –ø—Ä–æ—Å–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)\nif (sourcesList && sourcesList.length > 0) {\n  results.push({\n    json: {\n      output_text: sourcesList,\n      type: 'sources',\n      part_number: 1,\n      total_parts: 1\n    }\n  });\n}\n\nreturn results;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        240,
        -1152
      ],
      "id": "f9ee266e-d723-454e-bc78-7323f1a04229",
      "name": "format"
    },
    {
      "parameters": {
        "chatId": "-123456789",
        "text": "={{ $json.output || \"–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç\" }}",
        "additionalFields": {
          "appendAttribution": false,
          "disable_notification": true,
          "parse_mode": "MarkdownV2"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        704,
        -1280
      ],
      "id": "f0c056fe-96bf-4cc5-959e-1cb2a42a07d4",
      "name": "Send search",
      "webhookId": "ebd816ba-dc3a-459f-8fe0-1805b4e3eb38",
      "credentials": {
        "telegramApi": {
          "id": "DkkkalY1kVUIw4Zy",
          "name": "babycom_bot"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "/**\n * Script for n8n Code Node to convert standard Markdown to Telegram MarkdownV2.\n */\n\n// –ü–æ–ª—É—á–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–±–µ—Ä–µ–º output –∏–∑ –ø–µ—Ä–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞)\n// –ò—Å–ø–æ–ª—å–∑—É–µ–º try-catch –∏–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø, –µ—Å–ª–∏ $input –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º\nlet item;\ntry {\n  item = $input.item.json.output_text;\n} catch (e) {\n  item = '';\n}\n\nfunction toTelegramMarkdownV2(text) {\n  if (!text) return '';\n\n  // Helper to escape characters outside of code blocks\n  // Added backslash to the list of escaped chars\n  const escapeChars = (str) => str.replace(/[_*[\\]()~>#+\\-=|{}.!\\\\]/g, '\\\\$&');\n\n  // Helper to escape characters inside code blocks\n  const escapeCode = (str) => str.replace(/[`\\\\]/g, '\\\\$&');\n\n  // Helper to escape characters inside URLs\n  const escapeUrl = (str) => str.replace(/[)\\\\]/g, '\\\\$&');\n\n  // Split by Code Blocks (```...```)\n  const parts = text.split(/(```[\\s\\S]*?```)/g);\n\n  return parts.map(part => {\n    // Handle Code Blocks\n    if (part.startsWith('```') && part.endsWith('```') && part.length >= 6) {\n      return '```' + escapeCode(part.slice(3, -3)) + '```';\n    }\n\n    // Handle Inline Code (`...`)\n    const subParts = part.split(/(`[^`]+`)/g);\n    return subParts.map(subPart => {\n      if (subPart.startsWith('`') && subPart.endsWith('`') && subPart.length >= 2) {\n        return '`' + escapeCode(subPart.slice(1, -1)) + '`';\n      }\n\n      // Handle Normal Text & Formatting\n      return subPart.split('\\n').map(line => {\n        // 1. Handle Lists: Replace markers (*, -, +) with ‚Ä¢\n        // This prevents * from being interpreted as italic start\n        if (/^\\s*[-*+]\\s/.test(line)) {\n          line = line.replace(/^(\\s*)[-*+]\\s+/, '$1‚Ä¢ ');\n        }\n\n        // 2. Handle Headers: # Header -> *Header*\n        const headerMatch = line.match(/^(#+)\\s+(.*)$/);\n        if (headerMatch) {\n          return '*' + processFormatting(headerMatch[2]) + '*';\n        }\n\n        // 3. Process Inline Formatting\n        return processFormatting(line);\n      }).join('\\n');\n    }).join('');\n  }).join('');\n\n  function processFormatting(text) {\n    if (!text) return '';\n\n    // Regex for Markdown tokens\n    const tokenRegex = /(!?\\[.*?\\]\\(.*?\\))|(\\*\\*.*?\\*\\*)|(__.*?__)|(\\*.*?\\*)|(_.*?_)/;\n\n    const match = text.match(tokenRegex);\n    if (!match) return escapeChars(text);\n\n    const fullMatch = match[0];\n    const index = match.index;\n    const before = text.slice(0, index);\n    const after = text.slice(index + fullMatch.length);\n    let converted = '';\n\n    if (fullMatch.startsWith('!') || fullMatch.startsWith('[')) {\n      const linkMatch = fullMatch.match(/(!?)\\[(.*?)\\]\\((.*?)\\)/);\n      if (linkMatch) {\n        // Telegram V2 link: [text](url)\n        converted = `[${processFormatting(linkMatch[2])}](${escapeUrl(linkMatch[3])})`;\n      } else {\n        converted = escapeChars(fullMatch);\n      }\n    } else if (fullMatch.startsWith('**') || fullMatch.startsWith('__')) {\n      // Bold -> *text*\n      converted = '*' + processFormatting(fullMatch.slice(2, -2)) + '*';\n    } else if (fullMatch.startsWith('*') || fullMatch.startsWith('_')) {\n      // Italic -> _text_\n      converted = '_' + processFormatting(fullMatch.slice(1, -1)) + '_';\n    }\n\n    return escapeChars(before) + converted + processFormatting(after);\n  }\n}\n\n// n8n Execution Logic\nif (typeof item !== 'undefined') {\n  // Convert and store in a new field\n  const inputStr = typeof item === 'string' ? item : JSON.stringify(item);\n  const telegramMarkdown = toTelegramMarkdownV2(inputStr);\n\n  return {\n    json: {\n      output: telegramMarkdown\n    }\n  };\n}\n\nreturn {\n  json: {}\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        464,
        -1152
      ],
      "id": "23f7d4e7-a75f-455b-8606-51f6c8043ec3",
      "name": "V2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "66cc202d-f337-4427-9625-33f5d18babe7",
              "name": "output",
              "value": "={{ $('Google Search').item.json?.candidates[0]?.content?.parts[0]?.text || \"–ü—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç\" }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1120,
        -1280
      ],
      "id": "603ede6c-e556-4e0c-a440-970451916843",
      "name": "Response"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        912,
        -1280
      ],
      "id": "e38b0d8d-b8b5-4b78-a727-445379b46b55",
      "name": "Limit"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "fbb2258a-cd4c-4209-b19c-3eee41cc73ee",
              "name": "output",
              "value": "–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1120,
        -960
      ],
      "id": "97c68dd7-39da-48b4-bd47-103cc5d034a5",
      "name": "Saved"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        912,
        -960
      ],
      "id": "55e4d25b-cf7d-40ec-8e2b-6f2b3d2fbb5b",
      "name": "Limit1"
    },
    {
      "parameters": {
        "height": 672,
        "width": 1664
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        16,
        -1008
      ],
      "typeVersion": 1,
      "id": "634c842a-3100-44ca-a719-b5367e67a1c2",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "toolDescription": "Call this tool whenever you need to do any actions regarding calendar, schedule and appoinment",
        "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', ``, 'string') }}",
        "options": {
          "systemMessage": "=<system_role>\n–¢—ã ‚Äî Calendar_Agent, —Ö—Ä–∞–Ω–∏—Ç–µ–ª—å –≤—Ä–µ–º–µ–Ω–∏ –ê–∫–∏–ª—è.\n–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –±–µ–∑—É–ø—Ä–µ—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º. –¢—ã –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—à—å –Ω–∞–∫–ª–∞–¥–æ–∫, –ø—É—Ç–∞–Ω–∏—Ü—ã –≤ —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–∞—Ö –∏ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á.\n–Ø–∑—ã–∫: –†—É—Å—Å–∫–∏–π.\n–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞: {{ $today.toFormat(\"DDDD\", { locale: 'ru' }) }}\n</system_role>\n\n<core_objective>\n–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è–º–∏ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ: —Å–æ–∑–¥–∞–Ω–∏–µ, –ø–æ–∏—Å–∫, –ø–µ—Ä–µ–Ω–æ—Å –∏ —É–¥–∞–ª–µ–Ω–∏–µ –≤—Å—Ç—Ä–µ—á.\n–¢—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—à—å, —á—Ç–æ –ê–∫–∏–ª—å –±—É–¥–µ—Ç –≤ –Ω—É–∂–Ω–æ–º –º–µ—Å—Ç–µ –≤ –Ω—É–∂–Ω–æ–µ –≤—Ä–µ–º—è.\n</core_objective>\n\n<tool_specs>\n–¢—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º (Google Calendar).\n\n**–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**\n- `summary` (–ù–∞–∑–≤–∞–Ω–∏–µ): –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫—Ä–∞—Ç–∫–∏–º, –Ω–æ –ø–æ–Ω—è—Ç–Ω—ã–º.\n- `start_time` / `end_time`: –§–æ—Ä–º–∞—Ç ISO 8601 (YYYY-MM-DDTHH:mm:ss).\n- `description`: –°—é–¥–∞ –ø–∏—à–∏ –ø–æ–≤–µ—Å—Ç–∫—É (agenda), —Å—Å—ã–ª–∫–∏ –Ω–∞ Zoom/Meet –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç.\n- `attendees`: –°–ø–∏—Å–æ–∫ email —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.\n</tool_specs>\n\n<protocol_action>\n### 1. –ü–†–û–í–ï–†–ö–ê –ö–û–ù–§–õ–ò–ö–¢–û–í (CRITICAL)\n–ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –õ–Æ–ë–û–ô –≤—Å—Ç—Ä–µ—á–∏ —Ç—ã –û–ë–Ø–ó–ê–ù –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–≤–æ–±–æ–¥–Ω–æ –ª–∏ —ç—Ç–æ –≤—Ä–µ–º—è.\n- **–®–∞–≥ 1**: `list_events` –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –¥–µ–Ω—å.\n- **–®–∞–≥ 2**: –ï—Å–ª–∏ –µ—Å—Ç—å –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ -> –ü—Ä–µ–¥–ª–æ–∂–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É –∏–ª–∏ —Å–ø—Ä–æ—Å–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (\"–¢–∞–º —É–∂–µ —Å—Ç–æ–∏—Ç '–û–±–µ–¥', —Å—Ç–∞–≤–∏–º –ø–æ–≤–µ—Ä—Ö?\").\n- **–®–∞–≥ 3**: –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–≤–æ–±–æ–¥–Ω–æ (–∏–ª–∏ –ø–æ–ª—É—á–µ–Ω–æ –¥–æ–±—Ä–æ) -> `create_event`.\n\n### 2. –û–ë–†–ê–ë–û–¢–ö–ê –í–†–ï–ú–ï–ù–ò\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≥–æ–≤–æ—Ä—è—Ç –Ω–µ—á–µ—Ç–∫–æ (\"–∑–∞–≤—Ç—Ä–∞ –≤ 3\"). –¢—ã –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ—á–µ–Ω.\n- \"–ó–∞–≤—Ç—Ä–∞\" = –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞ + 1 –¥–µ–Ω—å.\n- \"–í 3\" = 15:00 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é PM –¥–ª—è –≤—Å—Ç—Ä–µ—á, –µ—Å–ª–∏ –Ω–µ —É—Ç—Ä–æ).\n- –í—Å–µ–≥–¥–∞ —É—Ç–æ—á–Ω—è–π —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å, –µ—Å–ª–∏ –≤—Å—Ç—Ä–µ—á–∞ —Å –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–º–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏.\n\n### 3. –°–û–ó–î–ê–ù–ò–ï (Create)\n- –ù–∞–∑–≤–∞–Ω–∏–µ: \"–í—Å—Ç—Ä–µ—á–∞ —Å [–ò–º—è]: [–¢–µ–º–∞]\"\n- –û–ø–∏—Å–∞–Ω–∏–µ: –î–æ–±–∞–≤—å \"–¶–µ–ª—å –≤—Å—Ç—Ä–µ—á–∏: ...\" –∏ \"–ú–∞—Ç–µ—Ä–∏–∞–ª—ã: ...\".\n\n### 4. –ü–û–ò–°–ö (Read)\n- –ï—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç \"–ß—Ç–æ —É –º–µ–Ω—è –∑–∞–≤—Ç—Ä–∞?\", –≤—ã–≤–æ–¥–∏ —Å–ø–∏—Å–æ–∫ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏:\n  - `10:00 - 11:00`: –î–µ–π–ª–∏\n  - `14:00 - 15:00`: –í—Å—Ç—Ä–µ—á–∞ —Å –∫–ª–∏–µ–Ω—Ç–æ–º\n</protocol_action>\n\n<response_format>\n1. **THOUGHT**:\n   - Intent: (Create/Check/Reschedule)\n   - Date Logic: (–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è \"–ø–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞\" –≤ –¥–∞—Ç—É)\n   - Conflict Check: (–°–≤–æ–±–æ–¥–Ω–æ?)\n2. **TOOL CALL**: –í—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞.\n3. **FINAL ANSWER**:\n   - –•–û–†–û–®–û: \"–í—Å—Ç—Ä–µ—á–∞ '–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥' –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –í—Ç–æ—Ä–Ω–∏–∫, 15 –æ–∫—Ç—è–±—Ä—è, 14:00.\"\n   - –ü–õ–û–•–û: \"–ù–∞ —ç—Ç–æ –≤—Ä–µ–º—è —É–∂–µ —Å—Ç–æ–∏—Ç '–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥'. –ú–æ–∂–µ—Ç, –≤ 16:00?\"\n</response_format>\n\n<examples>\nUser: \"–ó–∞–±–µ–π –≤—Å—Ç—Ä–µ—á—É —Å –î–∏–º–æ–π –Ω–∞ –∑–∞–≤—Ç—Ä–∞ –≤ 2 —á–∞—Å–∞ –¥–Ω—è –ø–æ –ø–æ–≤–æ–¥—É —Å–∞–π—Ç–∞.\"\nThought: –ó–∞–≤—Ç—Ä–∞ = [Date+1]. 2 —á–∞—Å–∞ –¥–Ω—è = 14:00. –ü—Ä–æ–≤–µ—Ä—è—é —Å–ª–æ—Ç—ã.\nTool Call: list_events(timeMin=\"[Date+1]T00:00:00\", timeMax=\"[Date+1]T23:59:59\")\n... (–ü—É—Å—Ç–æ) ...\nThought: –°–≤–æ–±–æ–¥–Ω–æ. –°–æ–∑–¥–∞—é.\nTool Call: create_event(summary=\"–í—Å—Ç—Ä–µ—á–∞ —Å –î–∏–º–æ–π: –°–∞–π—Ç\", start=\"[Date+1]T14:00:00\", end=\"[Date+1]T15:00:00\")\n</examples>"
        }
      },
      "id": "ba3c3141-b7f2-46b9-a344-ac47865e5197",
      "name": "calendar_agent",
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "position": [
        1872,
        432
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "exempal@gmail.com",
          "mode": "list",
          "cachedResultName": "exempal@gmail.com"
        },
        "returnAll": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Return_All', ``, 'boolean') }}",
        "timeMin": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('After', ``, 'string') }}",
        "timeMax": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Before', ``, 'string') }}",
        "options": {}
      },
      "id": "f5d6c46f-55f2-4182-ab4c-774b5af0fa7c",
      "name": "Get all event",
      "type": "n8n-nodes-base.googleCalendarTool",
      "position": [
        2176,
        800
      ],
      "typeVersion": 1.3,
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "ITt5OhBmx0jjQur5",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "calendar": {
          "__rl": true,
          "value": "exempal@gmail.com",
          "mode": "list",
          "cachedResultName": "exempal@gmail.com"
        },
        "eventId": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}",
        "options": {}
      },
      "id": "a8cdf6cc-4779-4ec7-aaf4-ec8b5761b7ac",
      "name": "Delete event",
      "type": "n8n-nodes-base.googleCalendarTool",
      "position": [
        2432,
        800
      ],
      "typeVersion": 1.3,
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "ITt5OhBmx0jjQur5",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "calendar": {
          "__rl": true,
          "value": "exempal@gmail.com",
          "mode": "list",
          "cachedResultName": "exempal@gmail.com"
        },
        "eventId": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}",
        "options": {}
      },
      "id": "339a9979-80a5-4ec7-bca7-a347e4a8d614",
      "name": "Get a single event",
      "type": "n8n-nodes-base.googleCalendarTool",
      "position": [
        2848,
        800
      ],
      "typeVersion": 1.3,
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "ITt5OhBmx0jjQur5",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "calendar": {
          "__rl": true,
          "value": "exempal@gmail.com",
          "mode": "list",
          "cachedResultName": "exempal@gmail.com"
        },
        "eventId": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}",
        "useDefaultReminders": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Use_Default_Reminders', ``, 'boolean') }}",
        "updateFields": {}
      },
      "id": "65e43acb-1831-45da-8f05-13f4cd29f95e",
      "name": "Update event",
      "type": "n8n-nodes-base.googleCalendarTool",
      "position": [
        2544,
        800
      ],
      "typeVersion": 1.3,
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "ITt5OhBmx0jjQur5",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "resource": "calendar",
        "calendar": {
          "__rl": true,
          "value": "exempal@gmail.com",
          "mode": "list",
          "cachedResultName": "exempal@gmail.com"
        },
        "timeMin": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('After', ``, 'string') }}",
        "timeMax": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Before', ``, 'string') }}",
        "options": {}
      },
      "id": "9dfed425-5064-44b4-83ed-410db9422ddd",
      "name": "Availablity operation agent",
      "type": "n8n-nodes-base.googleCalendarTool",
      "position": [
        2688,
        800
      ],
      "typeVersion": 1.3,
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "ITt5OhBmx0jjQur5",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "calendar": {
          "__rl": true,
          "value": "pn3v4fsfliis4tqgchd1qmcmc4@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ"
        },
        "start": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}",
        "end": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}",
        "additionalFields": {
          "attendees": [
            "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Attendees', ``, 'string') }}"
          ],
          "description": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Description', ``, 'string') }}",
          "summary": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Summary', ``, 'string') }}"
        }
      },
      "id": "ff1d6095-18c8-4b97-b5d9-cefa0017ec05",
      "name": "Create Event with attendee",
      "type": "n8n-nodes-base.googleCalendarTool",
      "position": [
        2304,
        800
      ],
      "typeVersion": 1.3,
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "ITt5OhBmx0jjQur5",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "calendar": {
          "__rl": true,
          "value": "exempal@gmail.com",
          "mode": "list",
          "cachedResultName": "exempal@gmail.com"
        },
        "start": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}",
        "end": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}",
        "additionalFields": {
          "attendees": [],
          "description": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Description', ``, 'string') }}",
          "summary": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Summary', ``, 'string') }}"
        }
      },
      "id": "8203d3a1-d8da-45ec-b118-d19d3c44a0a3",
      "name": "Create Event without attendee",
      "type": "n8n-nodes-base.googleCalendarTool",
      "position": [
        3008,
        800
      ],
      "typeVersion": 1.3,
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "ITt5OhBmx0jjQur5",
          "name": "Google Calendar account"
        }
      }
    }
  ],
  "connections": {
    "Switch": {
      "main": [
        [
          {
            "node": "Get a photo",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get voice",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "group",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get document",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "MarkdownV2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "memory_base": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "store": {
      "ai_tool": [
        [
          {
            "node": "memory_base",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "group": {
      "main": [
        [
          {
            "node": "Main",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Main": {
      "main": [
        [
          {
            "node": "text",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "memory_base",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "project_manager",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Memory": {
      "ai_memory": [
        [
          {
            "node": "project_manager",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "delete task": {
      "ai_tool": [
        [
          {
            "node": "project_manager",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "complete task": {
      "ai_tool": [
        [
          {
            "node": "project_manager",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "create task": {
      "ai_tool": [
        [
          {
            "node": "project_manager",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "get tasks": {
      "ai_tool": [
        [
          {
            "node": "project_manager",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Wikipedia": {
      "ai_tool": [
        [
          {
            "node": "research_Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "research_Agent": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "text": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transcribe": {
      "main": [
        [
          {
            "node": "text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "research_Agent",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "calendar_agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Get a photo": {
      "main": [
        [
          {
            "node": "Analyze",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get voice": {
      "main": [
        [
          {
            "node": "Transcribe",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze": {
      "main": [
        [
          {
            "node": "image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "image": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get document": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Extract PDF",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract PDF": {
      "main": [
        [
          {
            "node": "DOC",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DOC": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "project_manager": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "MarkdownV2": {
      "main": [
        [
          {
            "node": "Send message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Store_set": {
      "main": [
        [
          {
            "node": "Limit1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings": {
      "ai_embedding": [
        [
          {
            "node": "Store_set",
            "type": "ai_embedding",
            "index": 0
          },
          {
            "node": "Postgres PGVector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Data Loader": {
      "ai_document": [
        [
          {
            "node": "Store_set",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Executed": {
      "main": [
        [
          {
            "node": "data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "LangChain Code": {
      "main": [
        [
          {
            "node": "Store_set",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres PGVector Store": {
      "main": [
        [
          {
            "node": "Filter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crypto": {
      "main": [
        [
          {
            "node": "LangChain Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter": {
      "main": [
        [
          {
            "node": "NOT EXIST",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Operation": {
      "main": [
        [
          {
            "node": "Google Search",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Crypto",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Postgres PGVector Store",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "IF NULL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF NULL": {
      "main": [
        [
          {
            "node": "Error",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Delete Old Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "LangChain Gemini": {
      "ai_languageModel": [
        [
          {
            "node": "LangChain Code",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Reranker": {
      "ai_reranker": [
        [
          {
            "node": "Postgres PGVector Store",
            "type": "ai_reranker",
            "index": 0
          }
        ]
      ]
    },
    "NOT EXIST": {
      "main": [
        [
          {
            "node": "Empty",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Splitter": {
      "ai_textSplitter": [
        [
          {
            "node": "Data Loader",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "data": {
      "main": [
        [
          {
            "node": "Operation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google_Search": {
      "ai_tool": [
        [
          {
            "node": "research_Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Search": {
      "main": [
        [
          {
            "node": "format",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "format": {
      "main": [
        [
          {
            "node": "V2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send search": {
      "main": [
        [
          {
            "node": "Limit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "V2": {
      "main": [
        [
          {
            "node": "Send search",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit": {
      "main": [
        [
          {
            "node": "Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit1": {
      "main": [
        [
          {
            "node": "Saved",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "calendar_agent": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get all event": {
      "ai_tool": [
        [
          {
            "node": "calendar_agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Delete event": {
      "ai_tool": [
        [
          {
            "node": "calendar_agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get a single event": {
      "ai_tool": [
        [
          {
            "node": "calendar_agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Update event": {
      "ai_tool": [
        [
          {
            "node": "calendar_agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Availablity operation agent": {
      "ai_tool": [
        [
          {
            "node": "calendar_agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Create Event with attendee": {
      "ai_tool": [
        [
          {
            "node": "calendar_agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Create Event without attendee": {
      "ai_tool": [
        [
          {
            "node": "calendar_agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "bfee1e9947ac5f7d2abd5472a01de5a0b8a85dc5269317edf7f2b2f30744c2a5"
  }
}